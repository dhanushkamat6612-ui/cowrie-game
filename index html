<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kamat Studio - Kaude</title>
    <style>
        :root {
            --bg: #fff5e6;
            --board-border: #3e2723;
            --cell-bg: #FFFDD0;
            --safe-color: #f0f0f0;
            --inner-bg: #e8f5e9;
            --waiting-bg: #a5d6a7;
            --gold: #ffd700;
        }

        body { 
            text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg); margin: 0; overflow: hidden; touch-action: manipulation;
        }

        /* Fixed Boot Screen */
        #boot-screen { 
            position: fixed; inset: 0; background: #000; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            z-index: 5000; transition: opacity 0.8s; 
        }
        #boot-screen img { width: 150px; height: auto; border-radius: 10px; margin-bottom: 20px; }

        #game-container { display: none; padding: 10px; height: 100vh; }

        /* Perfect Square Board */
        .board { 
            display: grid; grid-template-columns: repeat(5, 1fr); 
            width: 95vw; height: 95vw; max-width: 400px; max-height: 400px; 
            margin: 15px auto; border: 5px solid var(--board-border); 
            background: var(--cell-bg); box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .cell { 
            border: 1px solid rgba(62, 39, 35, 0.3); 
            position: relative; display: flex; justify-content: center; align-items: center;
        }

        .inner-layer { background-color: var(--inner-bg); }
        .waiting-box { background-color: var(--waiting-bg); border: 2px solid #2e7d32; }
        .win-block { background-color: var(--gold); font-weight: bold; border: 2px double var(--board-border); }
        
        /* Safe Zones (X Squares) */
        .safe { 
            background-image: 
                linear-gradient(45deg, transparent 47%, var(--board-border) 49%, var(--board-border) 51%, transparent 53%),
                linear-gradient(-45deg, transparent 47%, var(--board-border) 49%, var(--board-border) 51%, transparent 53%);
        }

        .token { 
            width: 24px; height: 24px; border-radius: 50%; 
            border: 2px solid #000; position: absolute;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 3px 6px rgba(0,0,0,0.3); z-index: 10;
        }

        .red-t { background: #ff5252; }
        .blue-t { background: #2196f3; }
        .green-t { background: #4caf50; }
        .yellow-t { background: #ffeb3b; }

        /* UI Controls */
        .ui-panel { display: flex; justify-content: space-around; align-items: center; margin-bottom: 10px; }
        #tossBtn { 
            padding: 15px 40px; font-size: 1.2rem; font-weight: bold;
            background: #d32f2f; color: #fff; border: none; border-radius: 12px;
            cursor: pointer; box-shadow: 0 4px #b71c1c;
        }
        #tossBtn:active { box-shadow: 0 0; transform: translateY(4px); }
        #tossBtn:disabled { background: #999; box-shadow: 0 4px #666; cursor: not-allowed; }

        .player-tag { padding: 8px 20px; border-radius: 20px; color: white; font-weight: bold; }
    </style>
</head>
<body>

<div id="boot-screen">
    <img src="1000116381.png" onerror="this.src='https://via.placeholder.com/150?text=Kamat+Studio'">
    <h2 style="color:white;">KAMAT STUDIO</h2>
</div>

<div id="game-container">
    <div class="ui-panel">
        <div id="player-status" class="player-tag">Waiting...</div>
        <div id="roll-display" style="font-size: 1.5rem; font-weight: bold;">Roll: -</div>
    </div>
    
    <div class="board" id="board"></div>
    
    <button id="tossBtn" onclick="toss()">TOSS</button>
</div>

<script>
    // Grid indices: 0..24
    // Path configuration matches your unique entrances per side
    const boardLayout = [
        2, 1, 0, 5, 10, 15, 20, 21, 22, 23, 24, 19, 14, 9, 4, 3 // Outer Loop (16 squares)
    ];

    const players = [
        { id: 0, color: 'red', start: 2, inner: [7, 6, 11, 16, 17, 18, 13, 8], entry: 3 },
        { id: 1, color: 'blue', start: 22, inner: [17, 18, 13, 8, 7, 6, 11, 16], entry: 23 },
        { id: 2, color: 'green', start: 10, inner: [11, 16, 17, 18, 13, 8, 7, 6], entry: 5 },
        { id: 3, color: 'yellow', start: 14, inner: [13, 8, 7, 6, 11, 16, 17, 18], entry: 9 }
    ];

    let turn = 0;
    let currentRoll = 0;
    let tokens = []; // State for all 16 tokens

    function initGame() {
        const boardEl = document.getElementById('board');
        // Create 25 cells
        for (let i = 0; i < 25; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.id = `cell-${i}`;
            if ([2, 10, 14, 22].includes(i)) cell.classList.add('safe');
            if ([6, 7, 8, 11, 13, 16, 17, 18].includes(i)) cell.classList.add('inner-layer');
            if ([7, 11, 13, 17].includes(i)) cell.classList.add('waiting-box');
            if (i === 12) { cell.classList.add('win-block'); cell.innerText = "GOAL"; }
            boardEl.appendChild(cell);
        }

        // Initialize tokens
        players.forEach(p => {
            const fullPath = generateFullPath(p);
            for (let t = 0; t < 4; t++) {
                const tokenObj = {
                    pId: p.id,
                    tId: t,
                    pos: 0, // index in fullPath
                    path: fullPath,
                    el: document.createElement('div')
                };
                tokenObj.el.className = `token ${p.color}-t`;
                tokenObj.el.onclick = () => moveToken(tokenObj);
                tokens.push(tokenObj);
                placeToken(tokenObj);
            }
        });
        updateUI();
    }

    function generateFullPath(p) {
        let path = [];
        let startIdx = boardLayout.indexOf(p.start);
        // 1. Full outer loop (15 steps)
        for (let i = 0; i < 15; i++) {
            path.push(boardLayout[(startIdx + i) % 16]);
        }
        // 2. Inner Spiral
        path.push(...p.inner);
        // 3. Goal
        path.push(12);
        return path;
    }

    function placeToken(token) {
        const cellId = token.path[token.pos];
        const cell = document.getElementById(`cell-${cellId}`);
        cell.appendChild(token.el);
        // Simple stacking logic
        const offset = token.tId * 3;
        token.el.style.transform = `translate(${offset}px, ${offset}px)`;
    }

    function toss() {
        let dice = [0,0,0,0].map(() => Math.random() > 0.5 ? 1 : 0);
        let ones = dice.filter(x => x === 1).length;
        
        // Rarity 10% for 4 and 8
        if ((ones === 4 || ones === 0) && Math.random() > 0.1) {
            ones = Math.floor(Math.random() * 3) + 1; // Force 1, 2, or 3
        }

        currentRoll = (ones === 0) ? 8 : ones;
        document.getElementById('roll-display').innerText = `Roll: ${currentRoll}`;
        document.getElementById('tossBtn').disabled = true;
        
        // Check if player has any valid moves
        const validMoves = tokens.filter(t => t.pId === turn && t.pos + currentRoll < t.path.length);
        if (validMoves.length === 0) {
            setTimeout(nextTurn, 1000);
        }
    }

    function moveToken(token) {
        if (token.pId !== turn || currentRoll === 0) return;
        const targetPos = token.pos + currentRoll;
        if (targetPos >= token.path.length) return;

        // Killing logic
        const targetCell = token.path[targetPos];
        if (![2, 10, 14, 22, 12].includes(targetCell)) {
            tokens.forEach(other => {
                if (other.pId !== turn && other.path[other.pos] === targetCell) {
                    other.pos = 0;
                    placeToken(other);
                }
            });
        }

        token.pos = targetPos;
        placeToken(token);
        
        if (currentRoll !== 4 && currentRoll !== 8) {
            nextTurn();
        } else {
            currentRoll = 0;
            document.getElementById('tossBtn').disabled = false;
        }
    }

    function nextTurn() {
        turn = (turn + 1) % players.length;
        currentRoll = 0;
        document.getElementById('tossBtn').disabled = false;
        updateUI();
    }

    function updateUI() {
        const status = document.getElementById('player-status');
        const p = players[turn];
        status.innerText = `${p.color.toUpperCase()}'s Turn`;
        status.style.backgroundColor = p.color === 'yellow' ? '#ccac00' : p.color;
        document.getElementById('roll-display').innerText = "Roll: -";
    }

    window.onload = () => {
        setTimeout(() => {
            document.getElementById('boot-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('boot-screen').style.display = 'none';
                document.getElementById('game-container').style.display = 'block';
                initGame();
            }, 800);
        }, 2000);
    };
</script>

</body>
</html>
