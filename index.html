<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Kamat Studio - Kaude</title>
  <style>
    body { text-align: center; font-family: sans-serif; background: #fff5e6; padding: 0; margin: 0; overflow: hidden; }
    
    /* Updated Boot Screen */
    #boot-screen { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 3000; transition: opacity 0.8s ease; }
    #boot-screen img { width: 220px; height: auto; margin-bottom: 20px; }
    
    #setup-screen { position: fixed; inset: 0; background: #fff5e6; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1500; }
    #game-container { padding: 10px; display: none; }
    
    .board { display: grid; grid-template-columns: repeat(5, 1fr); width: 92vw; height: 92vw; max-width: 380px; max-height: 380px; margin: 10px auto; border: 4px solid #3e2723; background: #FFFDD0; }
    .cell { border: 1px solid #3e2723; position: relative; display: flex; justify-content: center; align-items: center; transition: background 0.3s; }
    
    .inner-layer { background-color: #e8f5e9 !important; }
    .waiting-box { background-color: #a5d6a7 !important; border: 3px solid #2e7d32 !important; box-sizing: border-box; }
    .win-block { background-color: #ffd700 !important; }
    
    .safe { background-image: linear-gradient(45deg, transparent 48%, #3e2723 50%, transparent 52%), linear-gradient(-45deg, transparent 48%, #3e2723 50%, transparent 52%); }
    .safe-glow { animation: glowPulse 2s infinite alternate; }
    
    @keyframes glowPulse {
      0% { box-shadow: inset 0 0 5px rgba(255,255,255,0.2); background-color: rgba(255,255,255,0.1); }
      100% { box-shadow: inset 0 0 20px rgba(255,255,255,0.8); background-color: rgba(255,255,255,0.4); }
    }
    
    .token { width: 22px; height: 22px; border-radius: 50%; border: 1.5px solid #000; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.2); z-index: 10; cursor: pointer; position: absolute; }
    .red-t { background: #ff5252; box-shadow: 0 2px 4px rgba(0,0,0,0.4); }
    .blue-t { background: #2196f3; box-shadow: 0 2px 4px rgba(0,0,0,0.4); }
    .green-t { background: #4caf50; box-shadow: 0 2px 4px rgba(0,0,0,0.4); }
    .yellow-t { background: #ffeb3b; box-shadow: 0 2px 4px rgba(0,0,0,0.4); }
    
    button { padding: 12px 30px; background: #d32f2f; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    button:disabled { background: #999; }
  </style>
</head>
<body>

  <div id="boot-screen">
    <img src="1000116381.png" alt="Logo">
    <h2 style="color:white; letter-spacing:3px; font-weight: lighter;">KAMAT STUDIO</h2>
  </div>

  <div id="setup-screen">
    <div style="background:white; padding:30px; border-radius:15px; box-shadow: 0 10px 20px rgba(0,0,0,0.2);">
      <h3>Kaude Setup</h3>
      <p>Players (2-4)</p>
      <input type="number" id="pCount" min="2" max="4" value="2" style="padding:8px; width:50px; text-align:center;">
      <div id="pNames" style="margin: 15px 0;"></div>
      <button onclick="launch()">START GAME</button>
    </div>
  </div>

  <div id="game-container">
    <div id="turn-display" style="padding:10px; color:white; font-weight:bold; margin-bottom:10px; border-radius:5px;"></div>
    <div id="score" style="font-size:26px; font-weight:bold; margin: 5px;">Roll: 0</div>
    <button id="tossBtn" onclick="throwKaude()">TOSS COWRY</button>
    <div class="board" id="gameBoard"></div>
  </div>

  <script>
    // Grid coordinate map
    const outerLoop = [2, 1, 0, 5, 10, 15, 20, 21, 22, 23, 24, 19, 14, 9, 4, 3];
    const colors = ['red', 'blue', 'green', 'yellow'];
    let players = [], turnIdx = 0, roll = 0;

    function launch() {
      const c = document.getElementById('pCount').value;
      for(let i=0; i<c; i++) {
        let start = [2, 22, 10, 14][i];
        players.push({ color: colors[i], start, path: generatePath(start, i), tokens: [0,0,0,0], finished: 0 });
      }
      document.getElementById('setup-screen').style.display = 'none';
      document.getElementById('game-container').style.display = 'block';
      renderBoard();
      updateUI();
    }

    function generatePath(start, pIdx) {
      let p = [];
      let sIdx = outerLoop.indexOf(start);
      
      // Step 1 to 15: Move around outer loop, stopping JUST BEFORE completing the revolution
      for(let i=0; i<15; i++) {
        p.push(outerLoop[(sIdx + i) % 16]);
      }
      
      // Step 16: Turn inside from the backside of home
      const spirals = [
        [7, 6, 11, 16, 17, 18, 13, 8],  // Red turns in
        [17, 18, 13, 8, 7, 6, 11, 16], // Blue turns in
        [11, 16, 17, 18, 13, 8, 7, 6], // Green turns in
        [13, 8, 7, 6, 11, 16, 17, 18]  // Yellow turns in
      ];
      
      p.push(...spirals[pIdx]); // Add the inner spiral
      p.push(12); // Final Gold Goal
      return p;
    }

    function renderBoard() {
      const b = document.getElementById('gameBoard');
      b.innerHTML = '';
      for(let i=0; i<25; i++) {
        let d = document.createElement('div');
        d.className = 'cell';
        d.id = 'cell-' + i;
        if([2,10,14,22,12].includes(i)) d.classList.add('safe');
        if([6,7,8,11,13,16,17,18].includes(i)) d.classList.add('inner-layer');
        if([7,11,13,17].includes(i)) d.classList.add('waiting-box');
        if(i===12) d.classList.add('win-block');
        b.appendChild(d);
      }
      
      players.forEach((p, pi) => {
        p.tokens.forEach((pos, ti) => {
          let t = document.createElement('div');
          t.className = `token ${p.color}-t`;
          t.id = `t-${pi}-${ti}`;
          t.onclick = () => handleMove(pi, ti);
          document.getElementById('cell-' + p.start).appendChild(t);
        });
      });
      updateSafeGlow();
    }

    function throwKaude() {
      let raw = 0;
      for(let i=0; i<4; i++) if(Math.random() > 0.5) raw++;
      // 10% rarity for 4 and 8
      if((raw === 0 || raw === 4) && Math.random() > 0.1) raw = Math.floor(Math.random()*3)+1;
      roll = (raw === 0) ? 8 : raw;
      document.getElementById('score').innerText = "Roll: " + roll;
      document.getElementById('tossBtn').disabled = (roll !== 4 && roll !== 8);
    }

    function handleMove(pi, ti) {
      if(pi !== turnIdx || roll === 0) return;
      let p = players[pi];
      let nextPos = p.tokens[ti] + roll;
      
      if(nextPos < p.path.length) {
        let target = p.path[nextPos];
        
        // KILL LOGIC: If landing on opponent (not on safe X)
        if(![2,10,12,14,22].includes(target)) {
          players.forEach((opp, oi) => {
            if(oi !== pi) {
              opp.tokens.forEach((opos, oti) => {
                if(opp.path[opos] === target) {
                  opp.tokens[oti] = 0;
                  document.getElementById('cell-' + opp.start).appendChild(document.getElementById(`t-${oi}-${oti}`));
                }
              });
            }
          });
        }

        p.tokens[ti] = nextPos;
        document.getElementById('cell-' + target).appendChild(document.getElementById(`t-${pi}-${ti}`));
        
        if(target === 12) { 
            document.getElementById(`t-${pi}-${ti}`).style.display = 'none'; 
            p.finished++; 
            if(p.finished === 4) alert(p.color.toUpperCase() + " WINS!");
        }
        
        if(roll !== 4 && roll !== 8) turnIdx = (turnIdx + 1) % players.length;
        roll = 0; 
        updateUI(); 
        updateSafeGlow();
        document.getElementById('tossBtn').disabled = false;
      }
    }

    function updateSafeGlow() {
      document.querySelectorAll('.cell').forEach((c) => {
        if(c.classList.contains('safe') && c.children.length > 0) c.classList.add('safe-glow');
        else c.classList.remove('safe-glow');
      });
    }

    function updateUI() {
      const p = players[turnIdx];
      const d = document.getElementById('turn-display');
      d.innerText = p.color.toUpperCase() + " TURN";
      d.style.background = p.color;
      document.getElementById('score').innerText = "Roll: 0";
    }

    window.onload = () => {
      setTimeout(() => {
        document.getElementById('boot-screen').style.opacity = '0';
        setTimeout(() => {
          document.getElementById('boot-screen').style.display = 'none';
          document.getElementById('setup-screen').style.display = 'flex';
        }, 800);
      }, 2500);
    };
  </script>
</body>
</html>
