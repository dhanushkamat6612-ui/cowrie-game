<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Kamat Studio - Kaude</title>
  <style>
    :root { --bg: #fff5e6; --board: #3e2723; --inner: #e8f5e9; --gold: #ffd700; --shell: #fdf5e6; }
    body { text-align: center; font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; overflow: hidden; touch-action: manipulation; }
    
    #boot-screen { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 5000; transition: opacity 0.8s ease; }
    #boot-screen img { width: 200px; height: auto; margin-bottom: 20px; }
    
    #setup-screen { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
    .setup-card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 85%; max-width: 320px; }
    
    #about-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; z-index: 6000; padding: 20px; overflow-y: auto; color: white; text-align: left; }
    .about-content { background: #3e2723; padding: 20px; border-radius: 15px; border: 2px solid var(--gold); line-height: 1.5; }

    #game-container { padding: 5px; display: none; height: 100vh; }
    .board { display: grid; grid-template-columns: repeat(5, 1fr); width: 95vw; height: 95vw; max-width: 420px; max-height: 420px; margin: 10px auto; border: 4px solid var(--board); background: #FFFDD0; }
    .cell { border: 1px solid rgba(62, 39, 35, 0.2); position: relative; display: flex; flex-wrap: wrap; align-content: center; justify-content: center; padding: 1px; gap: 2px; }
    
    .inner-layer { background-color: var(--inner) !important; }
    .win-block { background-color: var(--gold) !important; border: 2px double var(--board); }
    .safe { background-image: linear-gradient(45deg, transparent 48%, #3e2723 50%, transparent 52%), linear-gradient(-45deg, transparent 48%, #3e2723 50%, transparent 52%); }

    /* Traditional Shell (Kaude) Styling */
    .token { 
        width: 12px; height: 16px; 
        background: var(--shell); 
        border-radius: 50% 50% 45% 45%; 
        border: 1px solid #c4b49d; 
        cursor: pointer; 
        position: relative; 
        box-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        display: flex; justify-content: center;
    }
    /* The "Mouth" of the shell */
    .token::after {
        content: ""; position: absolute; top: 4px; width: 2px; height: 8px;
        background: rgba(0,0,0,0.2); border-radius: 10px;
    }
    
    /* Player Color Indicator (Small dot on shell) */
    .token::before {
        content: ""; position: absolute; top: -3px; width: 6px; height: 6px; 
        border-radius: 50%; border: 1px solid rgba(0,0,0,0.3);
    }
    .red-t::before { background: #ff4444; } 
    .blue-t::before { background: #2288ff; } 
    .green-t::before { background: #00aa00; } 
    .yellow-t::before { background: #ffcc00; }
    
    #msg-overlay { position: fixed; top: 25%; left: 50%; transform: translateX(-50%); background: white; color: #3e2723; padding: 20px; border-radius: 20px; z-index: 4000; display: none; border: 4px solid #d32f2f; font-weight: bold; width: 85%; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }

    .btn { padding: 12px 20px; margin: 8px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; }
    .btn-red { background: #d32f2f; color: white; box-shadow: 0 4px #9a1a1a; }
    .btn-gold { background: var(--gold); color: #3e2723; }
    .bonus-glow { animation: glow 0.8s infinite alternate; }
    @keyframes glow { from { box-shadow: 0 0 5px #ffcc00; } to { box-shadow: 0 0 20px #ffcc00; } }
  </style>
</head>
<body>

  <div id="boot-screen">
    <img src="1000116381.png" alt="Logo">
    <h2 style="color:white; letter-spacing:4px;">KAMAT STUDIO</h2>
  </div>

  <div id="setup-screen">
    <div class="setup-card">
      <h2 style="margin-top:0; color:#3e2723">Kaude</h2>
      <p>Select number of players:</p>
      <select id="pCount" style="width:100%; padding:10px; border-radius:10px; margin-bottom:15px;">
        <option value="2">2 Players</option>
        <option value="3">3 Players</option>
        <option value="4" selected>4 Players</option>
      </select>
      <button class="btn btn-red" style="width:100%" onclick="startGame()">START GAME</button>
      <button class="btn btn-gold" style="width:100%" onclick="toggleAbout(true)">ABOUT & RULES</button>
    </div>
  </div>

  <div id="about-modal">
    <div class="about-content">
      <h3 style="color:var(--gold)">Game Rules</h3>
      <p>‚Ä¢ <b>Goal:</b> Get all 4 Kaude shells to the center gold house.</p>
      <p>‚Ä¢ <b>The Lock:</b> Hey! You haven't killed a player, you would be locked later if you didn't kill any.</p>
      <p>‚Ä¢ <b>Movement:</b> Red moves Down, Blue Up, and others sideways at the 16th step.</p>
      <p>‚Ä¢ <b>Triple Roll:</b> Three 4s or 8s in a row forfeits your turn!</p>
      <button class="btn btn-gold" onclick="toggleAbout(false)">GOT IT</button>
    </div>
  </div>

  <div id="msg-overlay"></div>

  <div id="game-container">
    <div style="display:flex; justify-content:space-around; align-items:center; margin-bottom:5px;">
        <div id="p-tag" style="padding:8px 15px; border-radius:20px; color:white; font-weight:bold;"></div>
        <div id="roll-text" style="font-size:1.4rem; font-weight:bold; color:#3e2723">Roll: 0</div>
    </div>
    <button id="tossBtn" class="btn btn-red" onclick="throwKaude()">TOSS</button>
    <div class="board" id="gameBoard"></div>
  </div>

  <script>
    const outerLoop = [2, 1, 0, 5, 10, 15, 20, 21, 22, 23, 24, 19, 14, 9, 4, 3];
    const starts = [2, 22, 10, 14];
    const names = ['Red', 'Blue', 'Green', 'Yellow'];
    let players = [], turnIdx = 0, rollValue = 0, bonusCount = 0;

    function toggleAbout(show) { document.getElementById('about-modal').style.display = show ? 'block' : 'none'; }

    function startGame() {
      const count = document.getElementById('pCount').value;
      for(let i=0; i<count; i++) {
        players.push({ name: names[i], color: names[i].toLowerCase(), start: starts[i], hasKill: false, tokens: [0,0,0,0], path: generatePath(starts[i], i) });
      }
      document.getElementById('setup-screen').style.display = 'none';
      document.getElementById('game-container').style.display = 'block';
      renderBoard(); updateUI();
    }

    function generatePath(start, pIdx) {
      let p = []; let sIdx = outerLoop.indexOf(start);
      for(let i=0; i<16; i++) p.push(outerLoop[(sIdx + i) % 16]);
      const innerPaths = [
        [7,6,11,16,17,18,13,8], [17,18,13,8,7,6,11,16], [11,16,17,18,13,8,7,6], [13,8,7,6,11,16,17,18]
      ];
      p.push(...innerPaths[pIdx], 12); return p;
    }

    function showMsg(txt) {
      const ov = document.getElementById('msg-overlay');
      ov.innerHTML = txt; ov.style.display = 'block';
      setTimeout(() => { ov.style.display = 'none'; }, 3500);
    }

    function throwKaude() {
      let raw = 0; for(let i=0; i<4; i++) if(Math.random() > 0.5) raw++;
      rollValue = (raw === 0) ? 8 : raw;
      document.getElementById('roll-text').innerText = "Roll: " + rollValue;
      document.getElementById('tossBtn').disabled = true;

      if(rollValue === 4 || rollValue === 8) {
        bonusCount++;
        if(bonusCount === 3) {
          showMsg(`Hey <b>${players[turnIdx].name}</b>, three bonuses! Turn forfeited. üé≤`);
          setTimeout(endTurn, 2000);
        } else { document.getElementById('tossBtn').classList.add('bonus-glow'); }
      } else { bonusCount = 0; }
    }

    function handleMove(pi, ti) {
      if(pi !== turnIdx || rollValue === 0 || bonusCount === 3) return;
      let p = players[pi], currentPos = p.tokens[ti], nextPos = currentPos + rollValue;

      if (nextPos >= 11 && nextPos < 15 && !p.hasKill) {
        showMsg(`Hey <b>${p.name}</b>, you haven't killed a player you would be locked later if you didn't kill any! üêö`);
      }
      if (currentPos <= 15 && nextPos > 15 && !p.hasKill) {
        showMsg(`Hey <b>${p.name}</b>, you are LOCKED! Kill someone to pass Step 15.`); return;
      }

      if(nextPos < p.path.length) {
        let targetCell = p.path[nextPos];
        if(![2,10,14,22,12].includes(targetCell)) {
          players.forEach((opp, oi) => { if(oi !== pi) {
            opp.tokens.forEach((opos, oti) => { if(opp.path[opos] === targetCell) {
              opp.tokens[oti] = 0; p.hasKill = true;
              document.getElementById('cell-' + opp.path[0]).appendChild(document.getElementById(`t-${oi}-${oti}`));
              showMsg(`Nice! <b>${p.name}</b> killed <b>${opp.name}</b>. Gate unlocked! üîì`);
            }});
          }});
        }
        p.tokens[ti] = nextPos;
        document.getElementById('cell-' + targetCell).appendChild(document.getElementById(`t-${pi}-${ti}`));
        if(targetCell === 12) document.getElementById(`t-${pi}-${ti}`).style.display = 'none';
        
        if(rollValue === 4 || rollValue === 8) { rollValue = 0; document.getElementById('tossBtn').disabled = false; }
        else { endTurn(); }
      }
    }

    function endTurn() { 
      turnIdx = (turnIdx + 1) % players.length; rollValue = 0; bonusCount = 0;
      document.getElementById('tossBtn').disabled = false; document.getElementById('tossBtn').classList.remove('bonus-glow'); updateUI(); 
    }

    function updateUI() {
      const p = players[turnIdx]; const tag = document.getElementById('p-tag');
      tag.innerText = p.name.toUpperCase() + (p.hasKill ? " ‚öîÔ∏è" : " üîí");
      tag.style.background = p.color === 'yellow' ? '#ccaa00' : p.color;
      document.getElementById('roll-text').innerText = "Roll: 0";
    }

    function renderBoard() {
      const b = document.getElementById('gameBoard'); b.innerHTML = '';
      for(let i=0; i<25; i++) {
        let d = document.createElement('div'); d.className = 'cell'; d.id = 'cell-' + i;
        if([2,10,14,22,12].includes(i)) d.classList.add('safe');
        if([6,7,8,11,13,16,17,18].includes(i)) d.classList.add('inner-layer');
        if(i===12) d.classList.add('win-block'); b.appendChild(d);
      }
      players.forEach((p, pi) => { p.tokens.forEach((pos, ti) => {
        let t = document.createElement('div'); t.className = `token ${p.color}-t`; t.id = `t-${pi}-${ti}`;
        t.onclick = () => handleMove(pi, ti); document.getElementById('cell-' + p.path[pos]).appendChild(t);
      });});
    }

    window.onload = () => { setTimeout(() => { document.getElementById('boot-screen').style.opacity = '0'; setTimeout(() => { document.getElementById('boot-screen').style.display = 'none'; }, 800); }, 2500); };
  </script>
</body>
</html>
