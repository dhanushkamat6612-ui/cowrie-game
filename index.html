<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Kamat Studio - Kaude</title>
  <style>
    body { text-align: center; font-family: sans-serif; background: #fff5e6; padding: 0; margin: 0; touch-action: manipulation; overflow: hidden; }
    #boot-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; justify-content: center; align-items: center; z-index: 2000; }
    #setup-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff5e6; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1500; }
    #game-container { padding: 10px; display: none; }
    
    .board { display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr); width: 94vw; height: 94vw; max-width: 380px; max-height: 380px; margin: 10px auto; border: 4px solid #3e2723; background: #FFFDD0; }
    .cell { border: 1px solid #3e2723; position: relative; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; }
    
    .inner-layer { background-color: #e8f5e9 !important; }
    .waiting-box { background-color: #a5d6a7 !important; border: 3px solid #2e7d32 !important; } /* Dark Green Box */
    .win-block { background-color: #ffd700 !important; border: 3px double #3e2723; }
    
    .safe { background-image: linear-gradient(45deg, transparent 48%, #3e2723 50%, transparent 52%), linear-gradient(-45deg, transparent 48%, #3e2723 50%, transparent 52%); }
    .highlight { background-color: rgba(46, 125, 50, 0.4) !important; border: 4px solid #2e7d32 !important; z-index: 20; }
    
    .token { width: 18px; height: 18px; border-radius: 50%; border: 1.5px solid #000; margin: 1px; transition: all 0.4s ease-in-out; }
    .red-t { background: #ff5252; } .blue-t { background: #2196f3; } .green-t { background: #4caf50; } .yellow-t { background: #ffeb3b; }
    .selected { transform: scale(1.8); box-shadow: 0 0 15px #000; z-index: 100; border-color: white; }

    .cowrie { width: 45px; }
    .spinning { animation: toss 0.6s ease-out; }
    @keyframes toss { 0% { transform: scale(0.5); } 100% { transform: scale(1) rotate(-360deg); } }
    
    button { padding: 14px 30px; background: #d32f2f; color: white; border: none; border-radius: 50px; font-weight: bold; margin-top: 10px; font-size: 18px; }
    .turn-indicator { font-weight: bold; padding: 10px 25px; border-radius: 30px; color: white; margin-bottom: 5px; display: inline-block; }
  </style>
</head>
<body>

  <div id="boot-screen"><img src="1000116381.png" style="width:80%; max-width:400px;"></div>

  <div id="setup-screen">
    <div style="background:white; padding:25px; border-radius:20px; width:85%; max-width:320px;">
      <h2 style="color:#3e2723;">Kamat Studio</h2>
      <input type="number" id="pCount" min="2" max="4" value="2" oninput="drawInputs()" style="width:60px; text-align:center;">
      <div id="pNames" style="margin: 15px 0;"></div>
      <button onclick="launch()">Start Kaude</button>
    </div>
  </div>

  <div id="game-container">
    <div id="turn-box" class="turn-indicator"></div>
    <div id="score" style="font-weight:bold; font-size:24px; margin: 5px;">Roll: 0</div>
    <div id="cowrieArea" style="display:flex; justify-content:center; gap:8px; min-height:60px;"></div>
    <button id="tossBtn" onclick="throwKaude()">Toss Cowries</button>
    <div class="board" id="gameBoard"></div>
  </div>

  <script>
    const outerRing = [2, 1, 0, 5, 10, 15, 20, 21, 22, 23, 24, 19, 14, 9, 4, 3];
    const innerRing = [7, 6, 11, 16, 17, 18, 13, 8];
    const startSquares = [2, 22, 10, 14];
    const colors = ['red', 'blue', 'green', 'yellow'];
    const hex = { red: '#ff5252', blue: '#2196f3', green: '#4caf50', yellow: '#ffeb3b' };

    let players = [], turnIdx = 0, roll = 0, cells = [];

    function drawInputs() {
      const c = document.getElementById('pCount').value;
      const box = document.getElementById('pNames'); box.innerHTML = '';
      for(let i=0; i<c; i++) box.innerHTML += `<input type="text" id="n${i}" style="width:85%; margin:5px; padding:10px;" placeholder="${colors[i]} Name">`;
    }
    drawInputs();

    function launch() {
      const c = document.getElementById('pCount').value;
      for(let i=0; i<c; i++) {
        let name = document.getElementById('n'+i).value || colors[i];
        let startGrid = startSquares[i];
        let startIdx = outerRing.indexOf(startGrid);
        
        let pPath = [];
        // 1. 15 Steps Outer
        for(let j=0; j<15; j++) pPath.push(outerRing[(startIdx + j) % 16]);
        
        // 2. Turn Inward
        const entryMap = { 2: 7, 22: 17, 10: 11, 14: 13 };
        let innerIdx = innerRing.indexOf(entryMap[startGrid]);
        
        // 3. 8 Steps Inner (Includes corner and blue scribble)
        for(let j=0; j<8; j++) pPath.push(innerRing[(innerIdx + j) % 8]);
        
        // 4. Final Gold Goal
        pPath.push(12);
        
        players.push({ name, color: colors[i], start: startGrid, path: pPath, tokens: [0,0,0,0], finished: 0 });
      }
      document.getElementById('setup-screen').style.display = 'none';
      document.getElementById('game-container').style.display = 'block';
      buildBoard();
      updateUI();
    }

    function buildBoard() {
      const b = document.getElementById('gameBoard');
      for(let i=0; i<25; i++) {
        let div = document.createElement('div');
        div.className = 'cell';
        if([2,10,14,22].includes(i)) div.classList.add('safe');
        if([6,7,8,11,13,16,17,18].includes(i)) div.classList.add('inner-layer');
        // Setting up the dark green "Waiting Boxes" per player images
        if([7,17,11,13].includes(i)) div.classList.add('waiting-box');
        if(i === 12) div.classList.add('win-block', 'safe');
        b.appendChild(div);
        cells[i] = div;
      }
      players.forEach((p, pi) => {
        for(let ti=0; ti<4; ti++) {
          let t = document.createElement('div');
          t.className = `token ${p.color}-t`;
          t.onclick = (e) => handleToken(e, pi, ti, t);
          cells[p.start].appendChild(t);
          p['el'+ti] = t;
        }
      });
    }

    function throwKaude() {
      const b = document.getElementById('tossBtn'); b.disabled = true;
      let h = 0; const a = document.getElementById('cowrieArea'); a.innerHTML = '';
      for(let i=0; i<4; i++) {
        let isH = Math.random() < 0.5;
        let img = document.createElement('img');
        img.src = isH ? 'hollow.png' : 'curved.png';
        img.className = 'cowrie spinning'; a.appendChild(img);
        if(isH) h++;
      }
      setTimeout(() => {
        roll = (h === 0) ? 8 : h;
        document.getElementById('score').innerText = "Roll: " + roll;
        if(roll === 4 || roll === 8) b.disabled = false;
      }, 600);
    }

    function handleToken(e, pi, ti, el) {
      if(roll === 0 || pi !== turnIdx) return;
      if(players[pi].tokens[ti] === 24) return; // Already finished
      
      e.stopPropagation();
      clear();
      el.classList.add('selected');
      let currentPos = players[pi].tokens[ti];
      let nextPos = currentPos + roll;

      // STRICT WIN LOGIC: Must roll exact number to enter Gold (12)
      if(nextPos <= 24) {
        let target = players[pi].path[nextPos];
        cells[target].classList.add('highlight');
        cells[target].onclick = () => {
          // Killing logic (only if not safe)
          if(![2,10,12,14,22].includes(target)) {
            players.forEach((opp, oi) => {
              if(oi !== pi) {
                for(let k=0; k<4; k++) {
                  if(opp.path[opp.tokens[k]] === target && opp.tokens[k] !== 0) {
                    cells[opp.start].appendChild(opp['el'+k]);
                    opp.tokens[k] = 0;
                  }
                }
              }
            });
          }
          cells[target].appendChild(el);
          players[pi].tokens[ti] = nextPos;
          if(nextPos === 24) { el.style.opacity = "0.5"; players[pi].finished++; checkWin(pi); }
          if(roll === 4 || roll === 8) endTurn(false); else endTurn(true);
        };
      }
    }

    function checkWin(pi) {
      if(players[pi].finished === 4) {
        alert("CONGRATULATIONS " + players[pi].name + "! YOU WON!");
        location.reload();
      }
    }

    function clear() {
      document.querySelectorAll('.cell').forEach(c => { c.classList.remove('highlight'); c.onclick = null; });
      document.querySelectorAll('.token').forEach(t => t.classList.remove('selected'));
    }

    function endTurn(skip) {
      if(skip) turnIdx = (turnIdx + 1) % players.length;
      roll = 0; clear(); updateUI();
      document.getElementById('tossBtn').disabled = false;
    }

    function updateUI() {
      const p = players[turnIdx];
      const b = document.getElementById('turn-box');
      b.innerText = p.name.toUpperCase() + "'S TURN";
      b.style.background = hex[p.color];
      document.getElementById('score').innerText = "Roll: 0";
    }

    window.onload = () => setTimeout(() => {
      document.getElementById('boot-screen').style.display = 'none';
      document.getElementById('setup-screen').style.display = 'flex';
    }, 2500);
  </script>
</body>
</html>
